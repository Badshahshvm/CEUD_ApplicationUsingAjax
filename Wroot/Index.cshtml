
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Employee Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="mb-4 text-center">Employee Management</h2>

        <form id="employeeForm" class="row g-3 shadow p-4 bg-white rounded">
            <input type="hidden" id="id" />

            <div class="col-md-6">
                <label for="name" class="form-label">Employee Name</label>
                <input type="text" id="name" class="form-control" required />
            </div>

            <div class="col-md-6">
                <label for="code" class="form-label">Employee Code</label>
                <input type="number" id="code" class="form-control" required />
            </div>

            <div class="col-md-6">
                <label for="dob" class="form-label">Date of Birth</label>
                <input type="date" id="dob" class="form-control" required />
            </div>

            <div class="col-md-6">
                <label for="city" class="form-label">City</label>
                <select id="city" class="form-select">
                    <option>Delhi</option>
                    <option>Mumbai</option>
                    <option>Patna</option>
                    <option>Banglore</option>
                    <option>Ahmedabad</option>
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label d-block">Gender</label>
                <div class="form-check form-check-inline">
                    <input type="radio" id="genderMale" name="gender" value="Male" class="form-check-input" checked />
                    <label class="form-check-label" for="genderMale">Male</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="radio" id="genderFemale" name="gender" value="Female" class="form-check-input" />
                    <label class="form-check-label" for="genderFemale">Female</label>
                </div>
            </div>

            <div class="col-md-6">
                <label for="status" class="form-label">Status</label>
                <select id="status" class="form-select">
                    <option>Active</option>
                    <option>Inactive</option>
                </select>
            </div>

            <div class="col-md-6">
                <label for="photo" class="form-label">Photo</label>
                <input type="file" id="photo" class="form-control" />
            </div>

            <div class="col-12 text-end">
                <button type="submit" class="btn btn-primary">Save Employee</button>
            </div>
        </form>

        <hr class="my-5" />

        <div class="table-responsive shadow p-3 bg-white rounded">
            <table class="table table-bordered table-striped" id="employeeTable">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Code</th>
                        <th>DOB</th>
                        <th>City</th>
                        <th>Gender</th>
                        <th>Status</th>
                        <th>Photo</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        const apiUrl = "/api/employee";

        function loadEmployees() {
            $.get(apiUrl, function (data) {
                const tbody = $("#employeeTable tbody");
                tbody.empty();
                $.each(data, function (i, emp) {
                    const photoStatus = emp.photoFileName
                        ? '<span style="color: green;">✔️</span>'
                        : '<span style="color: red;">❌</span>';

                    const row = `
                            <tr>
                                <td>${emp.name}</td>
                                <td>${emp.code}</td>
                                <td>${emp.dob}</td>
                                <td>${emp.city}</td>
                                <td>${emp.gender}</td>
                                <td>${emp.status}</td>
                                <td class="text-center">${photoStatus}</td>
                                <td>
                                    <button class="btn btn-sm btn-info me-1" onclick="editEmployee(${emp.id})">Edit</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${emp.id})">Delete</button>
                                </td>
                            </tr>
                        `;
                    tbody.append(row);
                });
            });
        }

        $("#employeeForm").submit(function (e) {
            e.preventDefault();

            const fileInput = $("#photo")[0];
            const file = fileInput.files[0];

            if (file) {
                const formData = new FormData();
                formData.append("file", file);

                $.ajax({
                    url: `${apiUrl}/upload`,
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (res) {
                        saveEmployee(res.fileName);
                    }
                });
            } else {
                saveEmployee(null);
            }
        });

        function saveEmployee(photoFileName) {
            const emp = {
                name: $("#name").val(),
                code: $("#code").val(),
                dob: $("#dob").val(),
                city: $("#city").val(),
                gender: $("input[name='gender']:checked").val(),
                status: $("#status").val(),
                photoFileName: photoFileName
            };

            const id = $("#id").val();
            const method = id ? "PUT" : "POST";
            const url = id ? `${apiUrl}/${id}` : apiUrl;

            $.ajax({
                url: url,
                type: method,
                contentType: "application/json",
                data: JSON.stringify(emp),
                success: function () {
                    $("#employeeForm")[0].reset();
                    $("#id").val("");
                    loadEmployees();
                }
            });
        }

        window.editEmployee = function (id) {
            $.get(`${apiUrl}/${id}`, function (emp) {
                $("#id").val(emp.id);
                $("#name").val(emp.name);
                $("#code").val(emp.code);
                $("#dob").val(emp.dob);
                $("#city").val(emp.city);
                $(`input[name="gender"][value="${emp.gender}"]`).prop("checked", true);
                $("#status").val(emp.status);
            });
        }

        window.deleteEmployee = function (id) {
            if (confirm("Are you sure you want to delete this employee?")) {
                $.ajax({
                    url: `${apiUrl}/${id}`,
                    type: "DELETE",
                    success: function () {
                        loadEmployees();
                    }
                });
            }
        }

        $(document).ready(function () {
            loadEmployees();
        });
    </script>
</body>
</html>

